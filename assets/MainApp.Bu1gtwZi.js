import{L as k,m as v,d as b,D as K,t as _,j as e,u as f}from"./ToastAssets.BxQat71I.js";import{R as p}from"./index.BJfUAbRs.js";const w=typeof window<"u",N=w?window.location.pathname==="/"?"lifo/lib":window.location.pathname.split("/").filter(Boolean)[0]:"lifo/libs",C=k(`${N}-preferences`),x=k(`${N}-search`),I="dcc997da5924421d93a2e4f9265a7c9f",T="a79dd4eb810242e8a5a58c1ae6f4c4b8",L=async()=>{const s=x.get("token_info");if(s?.access_token&&Date.now()<s.expires_at)return s.access_token;const t=btoa(`${I}:${T}`),a=await(await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:`Basic ${t}`,"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"client_credentials"})})).json();return x.update("token_info",{...a,expires_at:Date.now()+a.expires_in*1e3}),a.access_token},A=async s=>{const t=await L();return(await(await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(s)}&type=track&limit=4`,{headers:{Authorization:`Bearer ${t}`}})).json()).tracks.items},P=async s=>{const t=await L(),a=await(await fetch(`https://api.spotify.com/v1/tracks/${s}`,{headers:{Authorization:`Bearer ${t}`}})).json();return console.log(a),a},R={historyResults:w?x.get("historyResults")||[]:[],searchResults:[]},i=v(R);i.subscribe(s=>{s.historyResults[0]?.id&&x.update("historyResults",s.historyResults)});const V=async s=>{const t=x.get("historyResults")||[];if(!t.some(c=>c.id===s.id)){const c=[s,...t].slice(0,4);i.setKey("historyResults",c)}const a=await P(s.id);d.setKey("spotifyCard",a),i.setKey("searchResults",[])},D=s=>{const o=(x.get("historyResults")||[]).filter(a=>a.id!==s);i.setKey("historyResults",o)},W=()=>{i.set(R)},j={selectSong:V,deleteSong:D,setDefault:W};b({asideRight:{isVisible:!1,isAnim:!1},asideLeft:{isVisible:!1,isAnim:!1}});const S={Dialog:K,toast:_},U={isUpload:!1,isMobile:window.innerWidth<768},d=v(U),B=()=>{S.Dialog.show({title:"Are you sure to leave?",message:"This acction is not reversible.",onClick:async()=>{d.set(U),i.set({...i.get(),isSearchClicked:!1,isUploading:!1})}})},H={close:B},m=b({musiclayer:{isMute:w?C.get("musiclayer/isMute"):!1,isOpen:!1}});m.subscribe(s=>{C.update("musiclayer",s.musiclayer)});const E={adjustment:e.jsx("path",{fill:"currentColor",d:"M10.83 5a3.001 3.001 0 0 0-5.66 0H4a1 1 0 1 0 0 2h1.17a3.001 3.001 0 0 0 5.66 0H20a1 1 0 1 0 0-2h-9.17ZM4 11h9.17a3.001 3.001 0 0 1 5.66 0H20a1 1 0 1 1 0 2h-1.17a3.001 3.001 0 0 1-5.66 0H4a1 1 0 1 1 0-2Zm1.17 6H4a1 1 0 1 0 0 2h1.17a3.001 3.001 0 0 0 5.66 0H20a1 1 0 1 0 0-2h-9.17a3.001 3.001 0 0 0-5.66 0Z"}),volumeUp:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.5 8.43A4.985 4.985 0 0 1 17 12a4.984 4.984 0 0 1-1.43 3.5m2.794 2.864A8.972 8.972 0 0 0 21 12a8.972 8.972 0 0 0-2.636-6.364M12 6.135v11.73a1 1 0 0 1-1.64.768L6 15H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h2l4.36-3.633a1 1 0 0 1 1.64.768Z"}),volumeMute:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.5 8.43A4.985 4.985 0 0 1 17 12c0 1.126-.5 2.5-1.5 3.5m2.864-9.864A8.972 8.972 0 0 1 21 12c0 2.023-.5 4.5-2.5 6M7.8 7.5l2.56-2.133a1 1 0 0 1 1.64.768V12m0 4.5v1.365a1 1 0 0 1-1.64.768L6 15H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1m1-4 14 14"}),music:e.jsx("path",{fill:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18.6216 3.21667c.2391.1897.3784.47817.3784.78334V15.6667c0 .0412-.0025.0818-.0073.1218.0048.0698.0073.1404.0073.2115 0 1.6569-1.3431 3-3 3s-3-1.3431-3-3 1.3431-3 3-3c.3506 0 .6872.0602 1 .1707V9.2602l-8 1.8667V18l-.00001.0032C8.99824 19.6586 7.65577 21 6 21c-1.65685 0-3-1.3431-3-3s1.34315-3 3-3c.35064 0 .68722.0602 1 .1707V6.33334c0-.46474.32018-.86823.77277-.97384l9.99953-2.33321c.1486-.03477.3012-.03465.4467-.00201.1427.03202.2783.09532.3964.18752.0021.00162.0041.00324.0062.00487Z"}),closeCircle:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"m15 9-6 6m0-6 6 6m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),search:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",d:"m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"}),close:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18 17.94 6M18 18 6.06 6"})};function h({icon:s="adjustment",size:t=24,...o}){return e.jsx("svg",{className:o.className||"",height:t,width:t,viewBox:"0 0 24 24",fill:"none",style:o.style,children:E[s]})}function M({...s}){return e.jsx("span",{className:`skeleton f-col ${s.className}`,style:{height:s?.style?.height||"18px",...s.style}})}function Z({isVisible:s}){const{searchResults:t,historyResults:o}=f(i),a=p.useRef(null),c=s?"opacity-1 pointer-events-auto":"opacity-0 pointer-events-none";p.useEffect(()=>{const l=u=>{const g=document.querySelector("[data-input-search]"),y=u.target,$=g?.contains(y),z=a.current?.contains(y);$||z||i.setKey("isSearchClicked",!1)};return window.addEventListener("pointerdown",l),()=>{window.removeEventListener("pointerdown",l)}},[]);const n=t.length?t:o,r=!t.length;return n.length?e.jsxs("section",{className:`absolute top-full left-1/2 bg-lifo-bg-secondary -translate-x-1/2 w-full mt-3 rounded-md h-max p-2 ${c}`,ref:a,children:[e.jsx("div",{className:"f-row gap-4 f-align-center justify-between w-full p-2 pt-2",children:e.jsx("p",{className:"m-0 px-1 fs-custom-14-5 fw-500 text-lifo-title",children:t.length?"Resultados":"Búsquedas recientes"})}),n.map((l,u)=>e.jsx(O,{data:l,isSearch:r,isVisible:s},u))]}):null}const O=p.memo(({data:s,isSearch:t,isVisible:o})=>{const{name:a="—",artists:c,album:n}=s,r=c?.[0]?.name??"Unknown artist",l=n?.images?.[2]?.url??"",[u,g]=p.useState(!1);return e.jsxs("div",{className:`search-list-card f-row gap-4 f-align-center w-full p-2 hover:bg-lifo-bg-third rounded-md ${o?"pointer":""}`,onClick:async()=>{await j.selectSong(s),i.set({...i.get(),isFile:!0,isUploading:!0}),d.setKey("isUpload",!0)},children:[e.jsxs("span",{className:"d-flex size-12",children:[!u&&e.jsx(M,{className:"size-12 rounded-sm absolute"}),e.jsx("img",{src:l,alt:`${a} cover image`,className:`size-12 rounded-sm object-cover d-flex f-center no-select ${u?"":"invisible"}`,onLoad:()=>g(!0)})]}),e.jsxs("div",{className:"f-row no-select f-grow justify-between overflow-hidden w-90",children:[e.jsxs("div",{className:"f-col leading-snug w-85",children:[e.jsx("span",{className:"fs-3 fw-400  text-nowrap truncate block",children:a}),e.jsx("span",{className:"fs-2 fw-500 text-lifo-text truncate block",children:r})]}),t&&e.jsx("span",{className:"d-flex f-center mr-2 pointer",onClick:y=>{y.stopPropagation(),j.deleteSong(s.id)},children:e.jsx(h,{icon:"close",size:22})})]})]})});function q(){const{isUploading:s,isSearchClicked:t}=f(i),o=p.useRef(null);p.useEffect(()=>{const n=r=>{const l=d.get();d.set({...l,isUpload:!0})};return window.addEventListener("paste",n),()=>{window.removeEventListener("paste",n)}},[]);async function a(n){i.setKey("isUploading",!0);const r=n.type.startsWith("image/"),l=n.type.startsWith("video/");if(!r&&!l){S.toast.error("Solo se permiten imágenes o videos"),i.setKey("isUploading",!1);return}const u=URL.createObjectURL(n);await new Promise(g=>setTimeout(g,180)),d.set({...d.get(),fileURL:u,fileType:r?"image":"video",isUpload:!0})}const c=n=>{const r=n.target.value;if(o.current&&clearTimeout(o.current),!r){j.setDefault();return}o.current=setTimeout(async()=>{const l=await A(r);i.setKey("searchResults",l),i.setKey("isSearchClicked",!0)},300)};return e.jsxs("section",{className:"f-col gap-4 f-center mb-10 px-3",children:[e.jsxs("div",{className:"bg-lifo-bg-secondary w-full h-12 px-2 f-row rounded-lg f-center relative",children:[e.jsx("input",{type:"text",className:"outline-none h-full ml-2 f-grow fs-custom-15",placeholder:"What do you want to play?",onClick:()=>i.setKey("isSearchClicked",!0),"data-input-search":"true",onChange:c}),e.jsx("span",{className:"size-11 pointer d-flex f-center",children:e.jsx(h,{icon:"search",size:26})}),e.jsx(Z,{isVisible:t})]}),e.jsxs("div",{className:"border-dashed border bg-lifo-bg-secondary border-lifo-border rounded-xl p-4 f-col f-center gap-4 max-w-3xl",children:[e.jsxs("label",{className:"p-3 pointer btn-secondary br-6 mt-3 cursor-pointer text",children:[s?"Uploading...":"Upload",e.jsx("input",{type:"file",accept:"image/*,video/*",className:"opacity-0 absolute w-0 h-0",onChange:async n=>{const r=n.target.files?.[0];r&&a(r)}})]}),e.jsx("span",{className:"fs-2",children:"Upload an image or Paste URL"}),e.jsx("span",{className:"fs-1 fw-400 mt-1 text-center text-lifo-text",children:"By uploading an image or URL you agree to our Terms of Use and Privacy Policy. "})]})]})}function F(s){const t=f(d)?.spotifyCard;return e.jsxs("div",{className:"spotify-card f-center absolute pointer","data-type":s.type,onClick:()=>{m.setKey("musiclayer.isOpen",!0)},children:[e.jsx("span",{className:"f-col f-center size-12 rounded-md no-select",children:e.jsx("img",{src:t?.album?.images[1]?.url,alt:"cover image",className:"h-full w-full rounded-xs object-cover d-flex f-center"})}),e.jsxs("div",{className:"f-col mr-2 no-select",children:[e.jsx("span",{className:"fs-custom-14-5 text-black",style:{fontWeight:530},children:t?.name}),e.jsx("span",{className:"fs-custom-14-5 fw-300 text-black",children:t?.artists[0]?.name})]}),e.jsx("audio",{src:t?.preview_url,children:"wasa"})]})}function G(){const{musiclayer:s}=f(m);return e.jsxs("div",{className:`h-full w-full d-flex absolute z-50 p-3 ${s.isOpen?"":"no-select"}`,onClick:t=>{t.stopPropagation(),m.setKey("musiclayer.isOpen",!1)},children:[e.jsxs("div",{className:"w-full h-max f-row justify-between",children:[e.jsxs("div",{className:"f-row gap-3 h-max pointer-events-auto",children:[e.jsx(h,{icon:"music",size:26}),e.jsx("span",{className:"pointer",onClick:()=>m.setKey("musiclayer.isMute",!s.isMute),children:e.jsx(h,{icon:s.isMute?"volumeMute":"volumeUp",size:26})})]}),e.jsx(h,{icon:"adjustment",size:26})]}),e.jsx(F,{type:"simple"})]})}function J(){const[s,t]=p.useState(!1),{isUpload:o,fileURL:a,fileType:c,spotifyCard:n}=f(d),{musiclayer:r}=f(m);return o?e.jsxs("main",{className:"h-[calc(100vh_-_18px)] w-full f-row relative f-center gap-4 px-3",children:[e.jsxs("section",{className:"aspect-[9/16] h-full max-h-screen rounded-lg relative d-flex f-center o-hidden p-3",children:[c==="image"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-full h-full f-col f-center absolute z-0 no-select",style:{backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center",filter:"blur(60px)",transform:"scale(1.2)"}}),e.jsx("img",{src:a,alt:"file upload img",className:"w-full object-cover z-1 rounded-md",loading:"eager"})]}):c==="video"?e.jsx("video",{src:a,className:"w-full object-cover z-1",controls:!0,autoPlay:!0}):null,e.jsx(G,{})]}),e.jsxs("section",{className:"bg-lifo-bg-secondary rounded-lg f-col h-full p-3 min-w-lg",children:[e.jsx("div",{children:e.jsx("span",{className:"rounded-full pointer pointer-events-auto h-max",onClick:()=>{H.close()},children:e.jsx(h,{icon:"closeCircle",size:32})})}),n&&e.jsxs("section",{children:[!s&&e.jsx(M,{className:"d-flex f-center w-full rounded-xl mt-3",style:{height:"152px"}}),e.jsx("iframe",{className:`rounded-xl mt-3 ${s?"opacity-1":"opacity-0"}`,src:`https://open.spotify.com/embed/track/${n?.id}?utm_source=generator`,width:"100%",height:"152px",allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture",loading:"eager",onLoad:()=>t(!0)})]})]})]}):null}function Q(){return e.jsx("div",{children:"mobileView"})}function ee(){const{isUpload:s,isMobile:t}=f(d);return s?t?e.jsx(Q,{}):e.jsx(J,{}):e.jsx(q,{})}export{ee as default};
